---
name: P1
description: 重大違反ゼロ（罰金・行政指導）に関するKPI確認。ユーザーが重大違反、罰金、行政指導、P1、コンプライアンス違反の状況について質問したときに使用する
---

# P1 — 重大違反ゼロ（罰金・行政指導）KPI確認スキル

重大違反ゼロ（罰金・行政指導）のKPIデータを xlsb ファイルから読み込み、ユーザーの質問に回答する。

## 対象ファイル

- ファイル名パターン: `*_S04_1_output.xlsb`
- シート: `List_1`
- ヘッダー開始位置: **9行目・B列**
- ヘッダー構成: **9〜11行目の3行**（マルチ行ヘッダー、結合セル対応済み）
  - 結合セルを含む。スクリプトが自動的に前方埋め（横・縦）で補完し、階層を `" | "` で結合する
  - 例: `大区分 | 中区分 | 詳細項目`
- データ開始位置: **12行目**（ヘッダー3行の直後）

## ワークフロー

1. プロジェクト内で `*_S04_1_output.xlsb` ファイルを探す
2. `headers` コマンドで `List_1` シートのヘッダー一覧を取得し、データ構造を把握する
3. ユーザーの質問内容に応じて適切なコマンド・絞り込みを実行する
4. 取得したデータをもとにユーザーへ回答する

## 重要な原則: ヘッダーの動的特定

**ヘッダー名はファイルによって微妙に異なる可能性がある。** そのため、どの質問パターンでも必ず最初に `headers` コマンドでヘッダー一覧を取得し、質問内容に関連するヘッダーを動的に特定すること。ハードコードされたヘッダー名に依存してはならない。

ヘッダー特定の手順:
1. `headers` コマンドでヘッダー一覧を取得する
2. 質問に関連するキーワード（例: 「課題発生」「行政指導」「罰金」「BU」「サイト」）でヘッダーを絞り込む
3. 一致するヘッダーが見つかったら、そのヘッダー名を使ってデータを取得・集計する
4. 一致するヘッダーが見つからない場合は、類似のヘッダー候補をユーザーに提示して確認する

## P1 重大違反ゼロの判定基準

以下の条件をすべて満たす場合に「P1 重大違反ゼロ」達成と判定する。

### フィルタ条件（スコープ）

- **部門集計**: BU/グループ名単位で集計する
- **年度**: 対象年度でフィルタする

### 判定ロジック

上記スコープでフィルタしたデータに対し、以下の条件で該当レコードを抽出する:

```
課題発生有無 = 0件
AND (行政指導がなし OR 行政指導罰金額 > 10,000 米ドル)
```

この条件に該当するレコードが **0件** であれば「重大違反ゼロ」達成。1件以上あれば未達成。

### 判定の実行手順

1. `headers` コマンドでヘッダーを取得し、以下のヘッダーを動的に特定する:
   - 「課題発生有無」を含むヘッダー
   - 「行政指導」を含むヘッダー（有無・分類）
   - 「罰金額」を含むヘッダー
   - 「BU」「グループ名」を含むヘッダー
   - 「年度」を含むヘッダー
2. `read` コマンドで全データを取得する
3. 対象年度・対象BU/グループ名でフィルタする
4. フィルタ後のデータに対して判定ロジックを適用し、該当レコード数を確認する
5. 0件なら「達成」、1件以上なら「未達成」と回答する

---

## 質問パターン別の対応手順

### 課題発生有無・達成状況を聞かれた場合

ユーザーが「達成状況」「課題はあるか」「違反はあるか」等を質問した場合は、以下の手順で回答する。

1. **ヘッダー一覧を取得**して、「課題発生有無」を含むヘッダーを特定する
   - 「課題発生有無 | 中間時」と「課題発生有無 | 年度末」のように時期別の列がある
   - どちらを参照すべきかは質問の文脈で判断する（指定がなければ最新の時期を使う）
2. **会社・組織で絞り込む** — ユーザーが特定の会社名（例: 日立ハイテク）を挙げた場合は `search` コマンドでその会社名を検索する
   - 会社名は「BU/グループ名」等の列に含まれる
3. **該当行の「課題発生有無」列の値を確認**し、達成/未達成を判定して回答する

**例: 「日立ハイテクの達成状況を教えて」と聞かれた場合**
```
Step 1: headers で列構造を把握
Step 2: search "日立ハイテク" で該当行を取得
Step 3: 「課題発生有無 | 中間時」や「課題発生有無 | 年度末」の値を確認
Step 4: 結果をもとに達成状況を回答
```

### 全体の状況を聞かれた場合

「全社の状況」「全体で違反はあるか」等の場合は、`read` コマンドで全データを取得し、「課題発生有無」列を集計して回答する。

### 行政指導の分類を聞かれた場合

ユーザーが「行政指導の分類」「行政指導の内訳」等を質問した場合は、以下の手順で回答する。

1. **ヘッダー一覧を取得**して、「行政指導」を含むヘッダーを特定する
   - ヘッダー名は微妙に異なる可能性があるため、必ず `headers` コマンドで取得し、「行政指導」というキーワードに一致する列を動的に特定する
2. **該当列のデータを確認**し、分類・件数等を集計して回答する
3. 特定の会社・BUで絞り込む場合は `search` コマンドで会社名を検索してから該当列を確認する

**例: 「行政指導の分類を教えて」と聞かれた場合**
```
Step 1: headers で列構造を把握 → 「行政指導」を含むヘッダーを特定
Step 2: read で全データ取得し、行政指導関連列の値を集計
Step 3: 分類別の件数・内容を回答
```

### 罰金額・行政対応を聞かれた場合

ユーザーが「罰金額」「行政対応の罰金」「罰金はいくらか」等を質問した場合は、以下の手順で回答する。

1. **ヘッダー一覧を取得**して、「行政対応」「罰金額」「罰金」等を含むヘッダーを特定する
   - ヘッダー名は微妙に異なる可能性があるため、必ず `headers` コマンドで取得し、キーワードに一致する列を動的に特定する
2. **該当列のデータを確認**し、罰金額の合計・内訳等を集計して回答する
3. 特定の会社・BUで絞り込む場合は `search` コマンドで会社名を検索してから該当列を確認する

**例: 「罰金額の状況を教えて」と聞かれた場合**
```
Step 1: headers で列構造を把握 → 「罰金」「行政対応」を含むヘッダーを特定
Step 2: read で全データ取得し、罰金額関連列の値を集計
Step 3: 罰金額の合計・会社別内訳を回答
```

### BU/グループ名での部門別集計を聞かれた場合

ユーザーが「部門別の状況」「BU別の集計」「グループ別の違反状況」等を質問した場合は、以下の手順で回答する。

1. **ヘッダー一覧を取得**して、「BU」「グループ名」等を含むヘッダーを特定する
2. **全データを取得**（`read --limit` で十分な行数を指定）し、BU/グループ名列でグループ分けして集計する
3. 集計対象の列（課題発生有無、罰金額、行政指導分類等）はユーザーの質問内容に応じて動的に選択する

**例: 「BU別の違反状況を教えて」と聞かれた場合**
```
Step 1: headers で列構造を把握 → 「BU」「グループ」を含むヘッダーと集計対象列を特定
Step 2: read --limit 500 で全データ取得
Step 3: BU/グループ名ごとに課題発生有無・違反件数を集計して回答
```

### サイト別の集計を聞かれた場合

ユーザーが「サイト別の状況」「拠点別の集計」等を質問した場合は、以下の手順で回答する。

1. **ヘッダー一覧を取得**して、「サイト」「拠点」等を含むヘッダーを特定する
2. **全データを取得**し、サイト列でグループ分けして集計する
3. 集計対象の列はユーザーの質問内容に応じて動的に選択する

**例: 「サイト別の違反件数を教えて」と聞かれた場合**
```
Step 1: headers で列構造を把握 → 「サイト」「拠点」を含むヘッダーと集計対象列を特定
Step 2: read --limit 500 で全データ取得
Step 3: サイトごとに違反件数・課題発生有無を集計して回答
```

### 特定項目・詳細を聞かれた場合

特定の違反内容やカテゴリを聞かれた場合は、`search` コマンドでキーワード検索し、該当行を絞り込んで回答する。

## コマンド

### ファイル探索（最初に実行）
```bash
find . -name "*_S04_1_output.xlsb" -type f
```

### ヘッダー一覧
```bash
uv run python {scripts}/read_xlsb.py headers <xlsb_file> --sheet List_1
```

### データ読み込み
```bash
uv run python {scripts}/read_xlsb.py read <xlsb_file> --sheet List_1 [--limit N]
```

### キーワード検索
```bash
uv run python {scripts}/read_xlsb.py search <xlsb_file> "キーワード" --sheet List_1
```

### 統計情報
```bash
uv run python {scripts}/read_xlsb.py info <xlsb_file> --sheet List_1
```

## 共通オプション

| オプション | デフォルト | 説明 |
|---|---|---|
| `--header-row` | `9` | ヘッダー開始行番号（1-indexed） |
| `--header-rows` | `3` | ヘッダーを構成する行数（9〜11行目の3行） |
| `--start-col` | `B` | 開始列（A, B, C, ...） |
| `--sheet` | 最初のシート | 対象シート名（P1では `List_1` を使う） |
| `--limit` | `50` | 表示行数（read コマンド用） |

## 回答のルール

- データの要約・集計はスクリプト出力をもとに行う
- 大量データの場合は `--limit` で適切に絞る
- 検索時は `search` コマンドを活用し、必要な行だけ取得する
- 数値データの場合は `info` コマンドで統計情報を先に確認する
- KPIの観点で「重大違反ゼロ」が達成されているかどうかを明確に回答する
- **Pythonスクリプトの新規作成・実行は禁止。** 上記「コマンド」セクションに記載された `read_xlsb.py` のコマンド（`headers` / `read` / `search` / `info`）のみを使用すること。データのフィルタや集計が必要な場合は、コマンド出力をLLMが読み取り、LLM自身の推論で判定・回答を行う
